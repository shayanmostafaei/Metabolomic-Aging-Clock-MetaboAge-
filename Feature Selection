# MetaboAge Feature Selection & Preprocessing
library(dplyr)
library(MASS)

# Remove highly correlated features
cor_matrix <- cor(clean_data, use = "pairwise.complete.obs")
high_corr <- which(abs(cor_matrix) > 0.99, arr.ind = TRUE)
high_corr_pairs <- as.data.frame(high_corr)
high_corr_pairs <- high_corr_pairs[high_corr_pairs$row < high_corr_pairs$col, ]
to_remove <- unique(colnames(clean_data)[high_corr_pairs$col])
clean_data <- clean_data %>% select(-one_of(to_remove))

# Box-Cox transform (for non-negative, skewed variables)
min_vals <- sapply(clean_data, min, na.rm = TRUE)
if(any(min_vals <= 0)) {
    clean_data <- clean_data + abs(min(min_vals)) + 1
}

# Save cleaned data
str(clean_data)
